<mxfile host="app.diagrams.net" modified="2024-01-01T00:00:00.000Z" agent="Mozilla/5.0" version="22.1.0" type="device">
  <diagram name="システム構成図" id="system-architecture">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="Document Creation System - システム構成図" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="350" y="20" width="400" height="40" as="geometry" />
        </mxCell>

        <!-- Docker Container Box -->
        <mxCell id="docker-box" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#666666;fillColor=#f5f5f5;dashed=1;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="600" y="100" width="300" height="350" as="geometry" />
        </mxCell>
        <mxCell id="docker-label" value="Docker Compose" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="690" y="105" width="120" height="20" as="geometry" />
        </mxCell>

        <!-- Browser -->
        <mxCell id="browser" value="ブラウザ" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="100" y="200" width="120" height="60" as="geometry" />
        </mxCell>

        <!-- SvelteKit App -->
        <mxCell id="sveltekit-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="300" y="130" width="220" height="200" as="geometry" />
        </mxCell>
        <mxCell id="sveltekit-label" value="SvelteKit 2 + Svelte 5" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="330" y="140" width="160" height="20" as="geometry" />
        </mxCell>
        <mxCell id="frontend" value="フロントエンド&#xa;(SSR/CSR)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="320" y="170" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="backend" value="バックエンド&#xa;(Server)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=12" vertex="1" parent="1">
          <mxGeometry x="420" y="170" width="90" height="50" as="geometry" />
        </mxCell>
        <mxCell id="drizzle" value="Drizzle ORM" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="320" y="240" width="90" height="35" as="geometry" />
        </mxCell>
        <mxCell id="arctic" value="Arctic (OIDC)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="420" y="240" width="90" height="35" as="geometry" />
        </mxCell>
        <mxCell id="vite" value="Vite 7" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="370" y="285" width="80" height="30" as="geometry" />
        </mxCell>

        <!-- PostgreSQL -->
        <mxCell id="postgres" value="PostgreSQL" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="630" y="150" width="100" height="80" as="geometry" />
        </mxCell>

        <!-- Keycloak -->
        <mxCell id="keycloak" value="Keycloak&#xa;(OIDC Provider)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="770" y="160" width="110" height="60" as="geometry" />
        </mxCell>

        <!-- Database Tables -->
        <mxCell id="db-tables" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="620" y="260" width="260" height="170" as="geometry" />
        </mxCell>
        <mxCell id="db-tables-label" value="Database Schema" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="700" y="265" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="users-table" value="users" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="630" y="290" width="70" height="25" as="geometry" />
        </mxCell>
        <mxCell id="sessions-table" value="sessions" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="710" y="290" width="70" height="25" as="geometry" />
        </mxCell>
        <mxCell id="hospitals-table" value="hospitals" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="790" y="290" width="70" height="25" as="geometry" />
        </mxCell>
        <mxCell id="memberships-table" value="hospital_memberships" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="630" y="325" width="120" height="25" as="geometry" />
        </mxCell>
        <mxCell id="invitations-table" value="invitations" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="760" y="325" width="100" height="25" as="geometry" />
        </mxCell>
        <mxCell id="groups-table" value="hospital_groups" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="680" y="360" width="100" height="25" as="geometry" />
        </mxCell>

        <!-- Arrows -->
        <mxCell id="arrow1" value="" style="endArrow=classic;startArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="browser" target="sveltekit-box">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow1-label" value="HTTP/HTTPS" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="230" y="205" width="60" height="20" as="geometry" />
        </mxCell>

        <mxCell id="arrow2" value="" style="endArrow=classic;startArrow=classic;html=1;rounded=0;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="sveltekit-box" target="postgres">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow2-label" value="SQL" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="560" y="160" width="40" height="20" as="geometry" />
        </mxCell>

        <mxCell id="arrow3" value="" style="endArrow=classic;startArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="sveltekit-box" target="keycloak">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        <mxCell id="arrow3-label" value="OIDC" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="560" y="205" width="40" height="20" as="geometry" />
        </mxCell>

        <mxCell id="arrow4" value="" style="endArrow=classic;startArrow=classic;html=1;rounded=0;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;curved=1;" edge="1" parent="1" source="browser" target="keycloak">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="160" y="100" />
              <mxPoint x="825" y="100" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="arrow4-label" value="OAuth2 Redirect" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="440" y="75" width="90" height="20" as="geometry" />
        </mxCell>

        <!-- Account Structure Section -->
        <mxCell id="account-title" value="アカウント構造" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="100" y="480" width="150" height="30" as="geometry" />
        </mxCell>

        <mxCell id="service-admin" value="サービス管理者&#xa;(isServiceAdmin: true)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="100" y="520" width="150" height="50" as="geometry" />
        </mxCell>

        <mxCell id="hospital-account" value="病院アカウント&#xa;(hospitals)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="100" y="610" width="150" height="50" as="geometry" />
        </mxCell>

        <mxCell id="hospital-admin" value="病院管理者&#xa;(hospital_admin)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="300" y="590" width="120" height="40" as="geometry" />
        </mxCell>

        <mxCell id="hospital-user" value="病院ユーザー&#xa;(hospital_user)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="300" y="640" width="120" height="40" as="geometry" />
        </mxCell>

        <mxCell id="acc-arrow1" value="" style="endArrow=classic;html=1;rounded=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="service-admin" target="hospital-account">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        <mxCell id="acc-arrow1-label" value="管理" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="180" y="577" width="40" height="20" as="geometry" />
        </mxCell>

        <mxCell id="acc-arrow2" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.25;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="hospital-account" target="hospital-admin">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>

        <mxCell id="acc-arrow3" value="" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="hospital-account" target="hospital-user">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>

        <mxCell id="invite-arrow1" value="招待" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;dashed=1;strokeColor=#b85450;" edge="1" parent="1" source="service-admin" target="hospital-admin">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="invite-arrow2" value="招待" style="endArrow=classic;html=1;rounded=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0;entryDx=0;entryDy=0;dashed=1;strokeColor=#82b366;" edge="1" parent="1" source="hospital-admin" target="hospital-user">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>

        <!-- Auth Flow Section -->
        <mxCell id="auth-title" value="認証フロー" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="550" y="480" width="100" height="30" as="geometry" />
        </mxCell>

        <mxCell id="flow1" value="1. /login" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="500" y="520" width="80" height="35" as="geometry" />
        </mxCell>
        <mxCell id="flow2" value="2. Keycloak&#xa;認証画面" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="610" y="520" width="80" height="35" as="geometry" />
        </mxCell>
        <mxCell id="flow3" value="3. /auth/callback" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="720" y="520" width="100" height="35" as="geometry" />
        </mxCell>
        <mxCell id="flow4" value="4. ユーザー&#xa;作成/更新" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="850" y="520" width="80" height="35" as="geometry" />
        </mxCell>
        <mxCell id="flow5" value="5. セッション&#xa;作成" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="500" y="580" width="80" height="35" as="geometry" />
        </mxCell>
        <mxCell id="flow6" value="6. 招待確認&#xa;(任意)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="610" y="580" width="80" height="35" as="geometry" />
        </mxCell>
        <mxCell id="flow7" value="7. リダイレクト&#xa;/admin or /{slug}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11" vertex="1" parent="1">
          <mxGeometry x="720" y="580" width="110" height="35" as="geometry" />
        </mxCell>

        <mxCell id="flow-arrow1" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1" source="flow1" target="flow2">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        <mxCell id="flow-arrow2" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1" source="flow2" target="flow3">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        <mxCell id="flow-arrow3" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1" source="flow3" target="flow4">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        <mxCell id="flow-arrow4" value="" style="endArrow=classic;html=1;rounded=0;exitX=0;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="flow4" target="flow5">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        <mxCell id="flow-arrow5" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1" source="flow5" target="flow6">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>
        <mxCell id="flow-arrow6" value="" style="endArrow=classic;html=1;rounded=0;" edge="1" parent="1" source="flow6" target="flow7">
          <mxGeometry width="50" height="50" relative="1" as="geometry" />
        </mxCell>

        <!-- Tech Stack Legend -->
        <mxCell id="legend-title" value="Tech Stack" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="100" y="350" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend1" value="SvelteKit 2 + Svelte 5" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="100" y="370" width="120" height="15" as="geometry" />
        </mxCell>
        <mxCell id="legend2" value="Drizzle ORM" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="100" y="385" width="80" height="15" as="geometry" />
        </mxCell>
        <mxCell id="legend3" value="PostgreSQL" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="100" y="400" width="80" height="15" as="geometry" />
        </mxCell>
        <mxCell id="legend4" value="Keycloak (OIDC)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="100" y="415" width="100" height="15" as="geometry" />
        </mxCell>
        <mxCell id="legend5" value="TypeScript (strict)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="100" y="430" width="100" height="15" as="geometry" />
        </mxCell>
        <mxCell id="legend6" value="Vite 7 + pnpm" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" vertex="1" parent="1">
          <mxGeometry x="100" y="445" width="100" height="15" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
